<!-- ===== C:\study\sem6\PPO\ppo\src\DetectiveUI\UI\Views\Tabs\ReadTabView.xaml ===== -->

<UserControl x:Class="DetectiveUI.Views.Tabs.ReadTabView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:DetectiveUI.Converters"
             xmlns:enum="clr-namespace:DTOs.Enum;assembly=DTOs">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="2*" />
        </Grid.ColumnDefinitions>

        <!-- Левая панель - поиск и список -->
        <Grid Grid.Column="0" Margin="5">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <GroupBox Grid.Row="0" Header="Фильтры поиска" Margin="0,0,0,5">
                <StackPanel>
                    <TextBlock Text="Поиск по ID" />
                    <StackPanel Orientation="Horizontal">
                        <TextBox Text="{Binding SearchById, UpdateSourceTrigger=PropertyChanged}" Width="150"
                                 Margin="0,0,5,0" />
                        <Button Content="Найти" Command="{Binding SearchByIdCommand}" Padding="5,2" />
                    </StackPanel>

                    <TextBlock Text="Полное имя" />
                    <TextBox Text="{Binding Filter.FullName, UpdateSourceTrigger=PropertyChanged}" />

                    <StackPanel Orientation="Horizontal">
                        <CheckBox IsChecked="{Binding UseSexFilter}"
                                  VerticalAlignment="Center"
                                  Margin="0,0,5,0" />
                        <ComboBox ItemsSource="{Binding SexList}"
                                  SelectedItem="{Binding Filter.Sex}"
                                  IsEnabled="{Binding UseSexFilter}"
                                  Width="120" />
                    </StackPanel>

                    <Grid Margin="0,5,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <DatePicker Grid.Column="0"
                                    SelectedDate="{Binding Filter.MinBirthDate, Converter={StaticResource DateOnlyToDateTimeConverter}}"
                                    Text="Дата рождения от" />
                        <DatePicker Grid.Column="1"
                                    SelectedDate="{Binding Filter.MaxBirthDate, Converter={StaticResource DateOnlyToDateTimeConverter}}"
                                    Text="Дата рождения до" />
                    </Grid>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,5,0,0">
                        <Button Content="Очистить" Command="{Binding ClearFiltersCommand}" Margin="0,0,5,0" />
                        <Button Content="Поиск" Command="{Binding SearchCommand}" />
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- Результаты поиска -->
            <GroupBox Grid.Row="1" Header="Результаты поиска" Margin="0,0,0,5">
                <DataGrid ItemsSource="{Binding Persons}"
                          SelectedItem="{Binding SelectedPerson}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ФИО" Binding="{Binding FullName}" Width="*" />
                        <DataGridTextColumn Header="Дата рождения"
                                            Binding="{Binding BirthDate, StringFormat=dd.MM.yyyy}" Width="100" />
                        <DataGridTextColumn Header="Пол"
                                            Binding="{Binding Sex, Converter={StaticResource EnumConverter}}"
                                            Width="100" />
                    </DataGrid.Columns>
                </DataGrid>
            </GroupBox>

            <!-- Сообщения об ошибках -->
            <TextBlock Grid.Row="2" Text="{Binding ErrorMessage}" Foreground="Red" TextWrapping="Wrap" />
        </Grid>

        <TabControl Grid.Column="1" Margin="5"
                    Visibility="{Binding SelectedPersonDetails, Converter={StaticResource NullVisibilityConverter}}">
            <TabItem Header="Общая информация">
                <ScrollViewer>
                    <StackPanel Margin="10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="ФИО:" Margin="0,0,5,5" />
                            <TextBox Grid.Row="0" Grid.Column="1"
                                     Text="{Binding SelectedPersonDetails.FullName, Mode=OneWay}"
                                     IsReadOnly="True"
                                     Margin="0,0,0,5"
                                     BorderThickness="0" />

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Дата рождения:" Margin="0,0,5,5" />
                            <TextBlock Grid.Row="1" Grid.Column="1"
                                       Text="{Binding SelectedPersonDetails.BirthDate, StringFormat=dd.MM.yyyy}"
                                       Margin="0,0,0,5" />

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Пол:" Margin="0,0,5,5" />
                            <TextBlock Grid.Row="2" Grid.Column="1"
                                       Text="{Binding SelectedPersonDetails.Sex, Converter={StaticResource EnumConverter}}"
                                       Margin="0,0,0,5" />

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="ID:" Margin="0,0,5,5" />
                            <TextBox Grid.Row="3" Grid.Column="1"
                                     Text="{Binding SelectedPersonDetails.Id, Mode=OneWay}"
                                     IsReadOnly="True"
                                     Margin="0,0,0,5"
                                     BorderThickness="0" />
                        </Grid>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Контакты">
                <DataGrid ItemsSource="{Binding Contacts}" AutoGenerateColumns="False" IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Тип"
                                            Binding="{Binding Type, Converter={StaticResource EnumConverter}}"
                                            Width="*" />
                        <DataGridTextColumn Header="Информация" Binding="{Binding Info}" Width="2*" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <TabItem Header="Связи">
                <DataGrid ItemsSource="{Binding Relationships}" AutoGenerateColumns="False" IsReadOnly="True"
                          SelectionUnit="CellOrRowHeader">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Тип связи"
                                            Binding="{Binding Type, Converter={StaticResource EnumConverter}}"
                                            Width="*" />
                        <DataGridTextColumn Header="ID связанного человека" Binding="{Binding Person2Id}"
                                            Width="*" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <TabItem Header="Документы">
                <DataGrid ItemsSource="{Binding Documents}" AutoGenerateColumns="False" IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Тип"
                                            Binding="{Binding typeDto, Converter={StaticResource EnumConverter}}"
                                            Width="*" />
                        <DataGridTextColumn Header="Данные" Binding="{Binding Payload}" Width="2*" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <TabItem Header="Имущество">
                <DataGrid ItemsSource="{Binding Properties}" AutoGenerateColumns="False" IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Тип" Binding="{Binding Type}" Width="*" />
                        <DataGridTextColumn Header="Стоимость" Binding="{Binding Cost, StringFormat={}{0:N0}}"
                                            Width="*" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <TabItem Header="Характеристики">
                <DataGrid ItemsSource="{Binding Characteristics}" AutoGenerateColumns="False" IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Автор" Binding="{Binding AuthorUsername}" Width="*" />
                        <DataGridTextColumn Header="Внешность" Binding="{Binding Appearance}" Width="2*" />
                        <DataGridTextColumn Header="Характер" Binding="{Binding Personality}" Width="2*" />
                        <DataGridTextColumn Header="Мед. показания" Binding="{Binding MedicalConditions}" Width="2*" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>